[WRITEUP] POWERSHELL MALWARE

[DeBai](https://i.imgur.com/rXK6u9w.png)

Mở chương trình trong HxD Editor

[Imgur](https://i.imgur.com/vE8wkyR.png)

Ta quan sát thấy có một đường link, thử lấy link đó nhé!!

[Link](https://drive.google.com/u/0/uc?id=12kM-s1qY4FwGT63c98hyeZBoZzs8uYz_)

Ta sẽ được tải xuống một file command.txt

[Imgur](https://i.imgur.com/SGrX6Qp.png)

Chạy các dòng lệnh trong powershell

[Imgur](https://i.imgur.com/Q3cvaHa.png)

Chạy lệnh **[System.Text.Encoding]::ASCII.GetString($o[0..1447])** ta được [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String("JFI9eyRELCRLPSRBcmdzOyRTPTAuLjI1NTswLi4yNTV8JXskSj0oJEorJFNbJF9dKyRLWyRfJSRLLkxlbmd0aF0pJTI1NjskU1skX10sJFNbJEpdPSRTWyRKXSwkU1skX119OyREfCV7JEk9KCRJKzEpJTI1NjskSD0oJEgrJFNbJEldKSUyNTY7JFNbJEldLCRTWyRIXT0kU1skSF0sJFNbJEldOyRfLWJ4b3IkU1soJFNbJEldKyRTWyRIXSklMjU2XX19O1t2b2lkXVtSZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgiTWljcm9zb2Z0LlZpc3VhbEJhc2ljIik7JEluID0gKFtzeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjgpLkdldEJ5dGVzKFtNaWNyb3NvZnQuVmlzdWFsQmFzaWMuSW50ZXJhY3Rpb25dOjpJbnB1dEJveCggIkVudGVyIGZsYWc6IiwiU2ltcGxlIENyYWNrbWUiKSk7W2J5dGVbXV0gJEsgPSAxMDksMTE1LDEwMSw5OSw5OSwxMTYsMTAyLDExNSwxMTEsOTksMTExLDExMSwxMDg7W2J5dGVbXV0gJEQgPSAxMDIsNDksOTksNTMsNTYsNTEsNTEsOTcsMTAxLDUyLDUwLDU3LDk3LDEwMiw1MiwxMDEsNTEsOTcsMTAxLDU3LDEwMiw1MSw1Myw1Myw5OSw5OSw0OSw1NCwxMDAsNTMsNTMsNDksNTcsOTcsNTEsNDksMTAyLDU0LDk3LDU1LDk4LDUwLDUzLDk4LDUxLDk4LDU1LDU3LDEwMiw0OSw1MCwxMDIsMTAyLDk4LDUzLDk3LDk3LDQ5LDUwLDQ5LDQ4LDUyLDEwMCw0OSw1NSw5OSw1NSw1NSw1NCw1NTskViA9ICgmICRSICRJbiAkS3wgRm9yRWFjaC1PYmplY3QgeyAiezA6WDJ9IiAtZiAkXyB9KSAtam9pbiAnJztpZihbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpBU0NJSS5HZXRTdHJpbmcoJEQpIC1lcSAkVil7W01pY3Jvc29mdC5WaXN1YWxCYXNpYy5JbnRlcmFjdGlvbl06Ok1zZ0JveCgiQ29ycmVjdCEiLCAiT2tPbmx5LFN5c3RlbU1vZGFsLEluZm9ybWF0aW9uIiwgIlN1Y2Nlc3MiKX1lbHNle1tNaWNyb3NvZnQuVmlzdWFsQmFzaWMuSW50ZXJhY3Rpb25dOjpNc2dCb3goIkluY29ycmVjdCEiLCAiT2tPbmx5LFN5c3RlbU1vZGFsLEV4Y2xhbWF0aW9uIiwgIkVycm9yIil9")) | iex

Convert sang Base 64 thui và bump

> $R={$D,$K=$Args;$S=0..255;0..255|%{$J=($J+$S[$_]+$K[$_%$K.Length])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bxor$S[($S[$I]+$S[$H])%256]}};[void][Reflection.Assembly]::LoadWithPartialName("Microsoft.VisualBasic");$In = ([system.Text.Encoding]::UTF8).GetBytes([Microsoft.VisualBasic.Interaction]::InputBox( "Enter flag:","Simple Crackme"));[byte[]] $K = 109,115,101,99,99,116,102,115,111,99,111,111,108;[byte[]] $D = 102,49,99,53,56,51,51,97,101,52,50,57,97,102,52,101,51,97,101,57,102,51,53,53,99,99,49,54,100,53,53,49,57,97,51,49,102,54,97,55,98,50,53,98,51,98,55,57,102,49,50,102,102,98,53,97,97,49,50,49,48,52,100,49,55,99,55,55,54,55;$V = (& $R $In $K| ForEach-Object { "{0:X2}" -f $_ }) -join '';if([System.Text.Encoding]::ASCII.GetString($D) -eq $V){[Microsoft.VisualBasic.Interaction]::MsgBox("Correct!", "OkOnly,SystemModal,Information", "Success")}else{[Microsoft.VisualBasic.Interaction]::MsgBox("Incorrect!", "OkOnly,SystemModal,Exclamation", "Error")}

Đọc qua và làm nhiều sẽ nhận thấy đây là mã hóa [RC4](https://en.wikipedia.org/wiki/RC4) với D là cipher text; K là key. Decode bằng [decode.fr](https://www.dcode.fr/rc4-cipher)

[flag](https://i.imgur.com/eJOSel2.png)

Flag: MSEC{P0w3rsh3ll_m4lw4r3_S0S_!!!!!!}
